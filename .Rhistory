dplyr::filter(currency == "USD") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio123 = sum(m12)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio123)) + geom_line() + geom_point() + ggtitle("Total 12m contrib USD")
pmidata %>%
dplyr::filter(currency == "EUR") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio123 = sum(m12)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio123)) + geom_line() + geom_point() + ggtitle("Total 12m contrib EUR")
pmidata %>%
dplyr::filter(currency == "GBP") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio123 = sum(m12)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio123)) + geom_line() + geom_point() + ggtitle("Total 12m contrib GBP")
pmidata %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio123 = sum(m12)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio123)) + geom_line() + geom_point() + ggtitle("Total 12m contrib")
pmidata %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio123 = sum(m12)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio123)) + geom_line() + geom_point() + ggtitle("Total 12m contrib")
pmidata %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio243 = sum(m24)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio243)) + geom_line() + geom_point() + ggtitle("Total 24m contrib")
pmidata %>%
dplyr::filter(currency == "USD") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio123 = sum(m12)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio123)) + geom_line() + geom_point() + ggtitle("Total 12m contrib USD")
pmidata %>%
dplyr::filter(currency == "EUR") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio123 = sum(m12)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio123)) + geom_line() + geom_point() + ggtitle("Total 12m contrib EUR")
pmidata %>%
dplyr::filter(currency == "GBP") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio123 = sum(m12)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio123)) + geom_line() + geom_point() + ggtitle("Total 12m contrib GBP")
pmidata %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio123 = sum(m12)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio123)) + geom_line() + geom_point() + ggtitle("Total 12m contrib")
pmidata %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio243 = sum(m24)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio243)) + geom_line() + geom_point() + ggtitle("Total 24m contrib")
pmidata %>%
dplyr::filter(currency == "USD") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio123 = sum(m12)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio123)) + geom_line() + geom_point() + ggtitle("Total 12m contrib USD")
pmidata %>%
dplyr::filter(currency == "EUR") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio123 = sum(m12)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio123)) + geom_line() + geom_point() + ggtitle("Total 12m contrib EUR")
pmidata %>%
dplyr::filter(currency == "GBP") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio123 = sum(m12)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio123)) + geom_line() + geom_point() + ggtitle("Total 12m contrib GBP")
pmidata %>%
dplyr::filter(currency == "USD") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio243 = sum(m24)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio243)) + geom_line() + geom_point() + ggtitle("Total 24m contrib USD")
pmidata %>%
dplyr::filter(currency == "EUR") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio243 = sum(m24)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio243)) + geom_line() + geom_point() + ggtitle("Total 24m contrib EUR")
pmidata %>%
dplyr::filter(currency == "GBP") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio243 = sum(m24)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio243)) + geom_line() + geom_point() + ggtitle("Total 24m contrib GBP")
pmidata %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio123 = sum(m12)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio123)) + geom_line() + geom_point() + ggtitle("Total 12m contrib")
pmidata %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio243 = sum(m24)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio243)) + geom_line() + geom_point() + ggtitle("Total 24m contrib")
pmidata %>%
dplyr::filter(currency == "USD") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio123 = sum(m12)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio123)) + geom_line() + geom_point() + ggtitle("Total 12m contrib USD")
pmidata %>%
dplyr::filter(currency == "EUR") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio123 = sum(m12)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio123)) + geom_line() + geom_point() + ggtitle("Total 12m contrib EUR")
pmidata %>%
dplyr::filter(currency == "DKK") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio123 = sum(m12)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio123)) + geom_line() + geom_point() + ggtitle("Total 12m contrib DKK")
pmidata %>%
dplyr::filter(currency == "GBP") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio123 = sum(m12)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio123)) + geom_line() + geom_point() + ggtitle("Total 12m contrib GBP")
pmidata %>%
dplyr::filter(currency == "USD") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio243 = sum(m24)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio243)) + geom_line() + geom_point() + ggtitle("Total 24m contrib USD")
pmidata %>%
dplyr::filter(currency == "EUR") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio243 = sum(m24)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio243)) + geom_line() + geom_point() + ggtitle("Total 24m contrib EUR")
pmidata %>%
dplyr::filter(currency == "GBP") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio243 = sum(m24)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio243)) + geom_line() + geom_point() + ggtitle("Total 24m contrib GBP")
pmidata %>%
dplyr::filter(currency == "DKK") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio243 = sum(m24)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio243)) + geom_line() + geom_point() + ggtitle("Total 24m contrib DKK")
pmidatawith31224 <- pmidata %>%
dplyr::mutate(model31224 = ifelse(creationdate >= parse_date_time("2015-11-30"), "3-12m-v1-2015-11-30", "pre-changes")) %>%
dplyr::mutate(model31224 = ifelse(creationdate >= parse_date_time("2016-05-16"), "12m-v2-2015-05-16", model31224)) %>%
dplyr::mutate(model31224 = ifelse(creationdate >= parse_date_time("2016-08-25") & currency != "EUR", "3-12-24m-2016-08-25",
model31224)) %>%
dplyr::mutate(model31224 = ifelse(creationdate >= parse_date_time("2016-10-01") & currency == "EUR", "3-12-24m-2016-08-25",
model31224)) %>%
dplyr::mutate(model31224 = ifelse(creationdate >= parse_date_time("2017-04-10") & (currency == "USD" | currency == "GBP"),
"pre-changes", model31224)) %>%
dplyr::mutate(model31224 = ifelse(creationdate >= parse_date_time("2017-10-13") & (currency == "EUR"),
"pre-changes", model31224)) %>%
dplyr::mutate(model31224 = ifelse(creationdate >= parse_date_time("2018-01-02") & currency == "EUR", "3-12-24m-2016-08-25",
model31224))
pmidatawith31224 <- pmidata %>%
dplyr::mutate(model31224 = ifelse(creationdate >= parse_date_time("2015-11-30"), "3-12m-v1-2015-11-30", "pre-changes"))
pmidatawith31224 <- pmidata %>%
dplyr::mutate(model31224 = ifelse(creationdate >= parse_date_time("2015-11-30", "ymd"), "3-12m-v1-2015-11-30", "pre-changes")) %>%
dplyr::mutate(model31224 = ifelse(creationdate >= parse_date_time("2016-05-16", "ymd"), "12m-v2-2015-05-16", model31224)) %>%
dplyr::mutate(model31224 = ifelse(creationdate >= parse_date_time("2016-08-25", "ymd") & currency != "EUR", "3-12-24m-2016-08-25",
model31224)) %>%
dplyr::mutate(model31224 = ifelse(creationdate >= parse_date_time("2016-10-01", "ymd") & currency == "EUR", "3-12-24m-2016-08-25",
model31224)) %>%
dplyr::mutate(model31224 = ifelse(creationdate >= parse_date_time("2017-04-10", "ymd") & (currency == "USD" | currency == "GBP"),
"pre-changes", model31224)) %>%
dplyr::mutate(model31224 = ifelse(creationdate >= parse_date_time("2017-10-13", "ymd") & (currency == "EUR"),
"pre-changes", model31224)) %>%
dplyr::mutate(model31224 = ifelse(creationdate >= parse_date_time("2018-01-02", "ymd") & currency == "EUR", "3-12-24m-2016-08-25",
model31224))
View(pmidatawith31224)
pmidata %>%
dplyr::filter(currency == "SEK") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio243 = sum(m24)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio243)) + geom_line() + geom_point() + ggtitle("Total 24m contrib DKK")
source('C:/123/data-analysis/Budget/ChallengeBudget/InvestigatePeriodModel.R')
pmidata <- pmidataraw %>%
# extract indicators for 3,12,24
dplyr::mutate(m3 = ifelse(paymentperiodchosenatstart == 3, 1, 0),
m12 = ifelse(paymentperiodchosenatstart == 12, 1, 0),
m24 = ifelse(paymentperiodchosenatstart == 24, 1, 0)) %>%
# truncate time
dplyr::filter(firstpaiddate > parse_date_time("2015-01-01", "ymd") & firstpaiddate < parse_date_time("2018-02-01", "ymd")) %>%
add31224model()
pmidata <- pmidataraw %>%
# extract indicators for 3,12,24
dplyr::mutate(m3 = ifelse(paymentperiodchosenatstart == 3, 1, 0),
m12 = ifelse(paymentperiodchosenatstart == 12, 1, 0),
m24 = ifelse(paymentperiodchosenatstart == 24, 1, 0)) %>%
# truncate time
dplyr::filter(firstpaiddate > parse_date_time("2015-01-01", "ymd") & firstpaiddate < parse_date_time("2018-02-01", "ymd")) %>%
add31224model()
View(pmidata)
source('C:/123/data-analysis/Budget/ChallengeBudget/InvestigatePeriodModel.R')
pmidata <- pmidataraw %>%
# extract indicators for 3,12,24
dplyr::mutate(m3 = ifelse(paymentperiodchosenatstart == 3, 1, 0),
m12 = ifelse(paymentperiodchosenatstart == 12, 1, 0),
m24 = ifelse(paymentperiodchosenatstart == 24, 1, 0)) %>%
# truncate time
dplyr::filter(firstpaiddate > parse_date_time("2015-01-01", "ymd") & firstpaiddate < parse_date_time("2018-02-01", "ymd")) %>%
add31224model()
pmidata %>%
dplyr::filter(model31224 != "None")
tmp <- pmidata %>%
dplyr::filter(model31224 != "None")
View(tmp)
tmp <- pmidata %>%
dplyr::filter(grepl("ex-", model31224)
tmp <- pmidata %>%
dplyr::filter(grepl("ex-", model31224))
View(tmp)
source('C:/123/data-analysis/Budget/ChallengeBudget/InvestigatePeriodModel.R')
pmidata <- pmidataraw %>%
# extract indicators for 3,12,24
dplyr::mutate(m3 = ifelse(paymentperiodchosenatstart == 3, 1, 0),
m12 = ifelse(paymentperiodchosenatstart == 12, 1, 0),
m24 = ifelse(paymentperiodchosenatstart == 24, 1, 0)) %>%
# truncate time
dplyr::filter(firstpaiddate > parse_date_time("2015-01-01", "ymd") & firstpaiddate < parse_date_time("2018-02-01", "ymd")) %>%
add31224model()
tmp <- pmidata %>%
dplyr::filter(grepl("ex-", model31224))
source('C:/123/data-analysis/Budget/ChallengeBudget/InvestigatePeriodModel.R')
pmidata <- pmidataraw %>%
# extract indicators for 3,12,24
dplyr::mutate(m3 = ifelse(paymentperiodchosenatstart == 3, 1, 0),
m12 = ifelse(paymentperiodchosenatstart == 12, 1, 0),
m24 = ifelse(paymentperiodchosenatstart == 24, 1, 0)) %>%
# truncate time
dplyr::filter(firstpaiddate > parse_date_time("2015-01-01", "ymd") & firstpaiddate < parse_date_time("2018-02-01", "ymd")) %>%
add31224model()
tmp <- pmidata %>%
dplyr::filter(grepl("ex-", model31224))
View(tmp)
source('C:/123/data-analysis/Budget/ChallengeBudget/InvestigatePeriodModel.R')
source('C:/123/data-analysis/Budget/ChallengeBudget/InvestigatePeriodModel.R')
pmidata %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio123 = sum(m12)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio123)) + geom_line() + geom_point() + ggtitle("Total 12m contrib")
pmidata %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio243 = sum(m24)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio243)) + geom_line() + geom_point() + ggtitle("Total 24m contrib")
pmidata %>%
dplyr::filter(currency == "USD") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio123 = sum(m12)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio123)) + geom_line() + geom_point() + ggtitle("Total 12m contrib USD")
pmidata %>%
dplyr::filter(currency == "EUR") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio123 = sum(m12)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio123)) + geom_line() + geom_point() + ggtitle("Total 12m contrib EUR")
pmidata %>%
dplyr::filter(currency == "DKK") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio123 = sum(m12)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio123)) + geom_line() + geom_point() + ggtitle("Total 12m contrib DKK")
pmidata %>%
dplyr::filter(currency == "GBP") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio123 = sum(m12)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio123)) + geom_line() + geom_point() + ggtitle("Total 12m contrib GBP")
pmidata %>%
dplyr::filter(currency == "USD") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio243 = sum(m24)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio243)) + geom_line() + geom_point() + ggtitle("Total 24m contrib USD")
pmidata %>%
dplyr::filter(currency == "EUR") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio243 = sum(m24)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio243)) + geom_line() + geom_point() + ggtitle("Total 24m contrib EUR")
pmidata %>%
dplyr::filter(currency == "GBP") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio243 = sum(m24)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio243)) + geom_line() + geom_point() + ggtitle("Total 24m contrib GBP")
pmidata %>%
dplyr::filter(currency == "DKK") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio243 = sum(m24)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio243)) + geom_line() + geom_point() + ggtitle("Total 24m contrib DKK")
source("../../Library/Util.R")
source("../../Budget/ChallengeBudget/InvestigatePeriodModel.R")
pmidataraw <- getInvestigatePeriodModelData()
pmidata <- pmidataraw %>%
# extract indicators for 3,12,24
dplyr::mutate(m3 = ifelse(paymentperiodchosenatstart == 3, 1, 0),
m12 = ifelse(paymentperiodchosenatstart == 12, 1, 0),
m24 = ifelse(paymentperiodchosenatstart == 24, 1, 0)) %>%
# truncate time
dplyr::filter(firstpaiddate > parse_date_time("2015-01-01", "ymd") & firstpaiddate < parse_date_time("2018-02-01", "ymd")) %>%
add31224model()
tmp <- pmidata %>%
dplyr::filter(grepl("ex-", model31224))
source('C:/123/data-analysis/Budget/ChallengeBudget/InvestigatePeriodModel.R')
pmidata <- pmidataraw %>%
# extract indicators for 3,12,24
dplyr::mutate(m3 = ifelse(paymentperiodchosenatstart == 3, 1, 0),
m12 = ifelse(paymentperiodchosenatstart == 12, 1, 0),
m24 = ifelse(paymentperiodchosenatstart == 24, 1, 0)) %>%
# truncate time
dplyr::filter(firstpaiddate > parse_date_time("2015-01-01", "ymd") & firstpaiddate < parse_date_time("2018-02-01", "ymd")) %>%
add31224model()
tmp <- pmidata %>%
dplyr::filter(grepl("ex-", model31224))
View(tmp)
factor(pmidata$model31224)
pmidata %>% dplyr::group_by(model31224) %>%
dplyr::summarise(length(customerid))
tmp <- pmidata %>% dplyr::group_by(model31224) %>%
dplyr::summarise(length(customerid))
View(tmp)
source('C:/123/data-analysis/Budget/ChallengeBudget/ChallengeBudgetData.R')
source('C:/123/data-analysis/Budget/ChallengeBudget/InvestigatePeriodModel.R')
tmp <- getCustomerAspect31224Model()
View(pmidata)
View(tmp)
source('C:/123/data-analysis/Budget/ChallengeBudget/ChallengeBudgetData.R')
tmp <- getCustomerAspect31224Model()
source('C:/123/data-analysis/Budget/ChallengeBudget/ChallengeBudgetData.R')
tmp <- getCustomerAspect31224Model()
View(tmp)
source('C:/123/data-analysis/Budget/ChallengeBudget/ChallengeBudgetData.R')
source('C:/123/data-analysis/Budget/ChallengeBudget/ChallengeBudgetData.R')
customersV2 <- getCustomersV2()
deviceandsegment <- getCustomerAspectDeviceAndSegment()
quickpurchase <- getCustomerAspectQuickPurchase()
productversion <- getCustomerAspectProductVersion()
freemium <- getCustomerAspectFreemium()
model31224 <- getCustomerAspect31224Model()
customersfinalV2 <- customersV2 %>%
dplyr::left_join(deviceandsegment, by = "customerid") %>%
dplyr::left_join(quickpurchase, by = "customerid") %>%
dplyr::left_join(productversion, by = "customerid") %>%
dplyr::left_join(freemium, by = "customerid") %>%
dplyr::left_join(model31224, by = "customerid")
subscriptionsV2 <- getSubscriptionsV2()
View(model31224)
customersV2 <- getCustomersV2()
deviceandsegment <- getCustomerAspectDeviceAndSegment()
quickpurchase <- getCustomerAspectQuickPurchase()
productversion <- getCustomerAspectProductVersion()
freemium <- getCustomerAspectFreemium()
model31224 <- getCustomerAspect31224Model()
customersfinalV2 <- customersV2 %>%
dplyr::left_join(deviceandsegment, by = "customerid") %>%
dplyr::left_join(quickpurchase, by = "customerid") %>%
dplyr::left_join(productversion, by = "customerid") %>%
dplyr::left_join(freemium, by = "customerid") %>%
dplyr::left_join(model31224, by = "customerid")
View(customersfinalV2)
source('C:/123/data-analysis/Budget/ChallengeBudget/ChallengeBudgetData.R')
subscriptionsV2 <- getSubscriptionsV2()
doDataSetV2()
customersV2 <- getFullCustomerSetV2() %>%
dplyr::filter(marketname == "US")
customersUSV2 <- getFullCustomerSetV2() %>%
dplyr::filter(marketname == "US")
customersV2 <- getFullCustomerSetV2()
customerids <- customersUSV2 %>%
dplyr::select(customerid)
customeridsUS <- customersUSV2 %>%
dplyr::select(customerid)
subscriptionsUSV2 <- getFullSubscriptionSetV2() %>%
dplyr::inner_join(customeridsUS)
source('C:/123/data-analysis/Budget/ChallengeBudget/ChallengeBudgetData.R')
doDataSetV2()
doDataSetUSV2()
source("../../Library/Util.R")
source("../../Budget/ChallengeBudget/InvestigatePeriodModel.R")
pmidataraw <- getInvestigatePeriodModelData()
pmidata <- pmidataraw %>%
# extract indicators for 3,12,24
dplyr::mutate(m3 = ifelse(paymentperiodchosenatstart == 3, 1, 0),
m12 = ifelse(paymentperiodchosenatstart == 12, 1, 0),
m24 = ifelse(paymentperiodchosenatstart == 24, 1, 0)) %>%
# truncate time
dplyr::filter(firstpaiddate > parse_date_time("2015-01-01", "ymd") & firstpaiddate < parse_date_time("2018-02-01", "ymd")) %>%
add31224model()
pmidata %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio123 = sum(m12)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio123)) + geom_line() + geom_point() + ggtitle("Total 12m contrib")
pmidata %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio243 = sum(m24)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio243)) + geom_line() + geom_point() + ggtitle("Total 24m contrib")
pmidata %>%
dplyr::filter(currency == "USD") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio123 = sum(m12)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio123)) + geom_line() + geom_point() + ggtitle("Total 12m contrib USD")
pmidata %>%
dplyr::filter(currency == "EUR") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio123 = sum(m12)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio123)) + geom_line() + geom_point() + ggtitle("Total 12m contrib EUR")
pmidata %>%
dplyr::filter(currency == "DKK") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio123 = sum(m12)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio123)) + geom_line() + geom_point() + ggtitle("Total 12m contrib DKK")
pmidata %>%
dplyr::filter(currency == "GBP") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio123 = sum(m12)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio123)) + geom_line() + geom_point() + ggtitle("Total 12m contrib GBP")
pmidata %>%
dplyr::filter(currency == "USD") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio243 = sum(m24)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio243)) + geom_line() + geom_point() + ggtitle("Total 24m contrib USD")
pmidata %>%
dplyr::filter(currency == "EUR") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio243 = sum(m24)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio243)) + geom_line() + geom_point() + ggtitle("Total 24m contrib EUR")
pmidata %>%
dplyr::filter(currency == "GBP") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio243 = sum(m24)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio243)) + geom_line() + geom_point() + ggtitle("Total 24m contrib GBP")
pmidata %>%
dplyr::filter(currency == "DKK") %>%
dplyr::group_by(firstpaidmonth) %>%
dplyr::summarise(ratio243 = sum(m24)/length(customerid)) %>%
ggplot(aes(x=firstpaidmonth, y=ratio243)) + geom_line() + geom_point() + ggtitle("Total 24m contrib DKK")
overview <-
data.table(name = c("Alternative12mSwitch", "Third12mSwitch", "UglyJerry12mSwitch", "PitchSwitchTo12mPSPeriodEur",
"SubscriptionPlanPaywall", "SubscriptionPlanPaywallExpand"),
startdate = c("2016-04-15", "2016-05-26", "2016-07-08", "2016-09-15", "2016-12-06", "2017-01-17"),
enddate = c("2016-05-10", "2016-06-28", "2016-08-24", "2016-10-20", "2017-01-17", "2017-03-14"),
m12 = c(0.25, 0.34, 0.38, 0.33, 0.45, 0.45),
m24 = c(0, 0, 0.05, 0.05, 0.12, 0.1),
currency = c("many", "implicit", "non-EUR", "EUR", "USD", "many"),
marketname = c("many", "implicit", "implicit", "implicit", "US", "many"),
culturekey = c("many", "en-US", "implicit", "implicit", "en-US", "many")
)
print(overview)
pmidata %>%
dplyr::filter(creationdate > parse_date_time("2016-04-10", "ymd") & creationdate < parse_date_time("2016-07-01", "ymd") ) %>%
analyzeExperiment("Alternative12mSwitch")
pmidata %>%
dplyr::filter(creationdate > parse_date_time("2015-04-10", "ymd") & creationdate < parse_date_time("2016-07-01", "ymd") ) %>%
analyzeExperiment("Third12mSwitch")
pmidata %>%
dplyr::filter(creationdate > parse_date_time("2015-04-10", "ymd") & creationdate < parse_date_time("2016-12-01", "ymd") ) %>%
analyzeExperiment("UglyJerry12mSwitch")
pmidata %>%
dplyr::filter(creationdate > parse_date_time("2015-11-01", "ymd") & creationdate < parse_date_time("2016-11-01", "ymd") ) %>%
analyzeExperiment("PitchSwitchTo12mPSPeriodEur")
pmidata %>%
dplyr::filter(creationdate > parse_date_time("2016-11-01", "ymd") & creationdate < parse_date_time("2017-07-01", "ymd") ) %>%
analyzeExperiment("SubscriptionPlanPaywall")
analyzeExperiment(pmidata, "SubscriptionPlanPaywallExpand")
setwd("C:/123/data-analysis/Budget/MonthBudget")
# initialise configuration, DB data and core parameters
source("../../Budget/MonthBudget/Init.R")
# do simulation
# init default
defaultconf <- getDefaultConf()
# fix defaults for stable test
defaultconf$salesbudgetfilename <- "sales budget for testing.xlsx"
defaultconf$monthsforchurn <- 3
defaultconf$churngobackmonths <- 0
defaultconf$monthsforcurrencies <- 3
defaultconf$currenciesgobackmonths <- 0
defaultconf$newsubsrevenuewindowmonths <- 3
defaultconf$newsubsrevenuegobackmonths <- 0
defaultconf$newsalessubsspectrumwindowmonths <- 1
defaultconf$newsalessubsspectrumgobackmonths <- 0
defaultconf$viralwindowmonths <- 3
defaultconf$viralgobackmonths <- 0
# start at well-defined time for this test
defaultconf$currentMonth <- parse_date_time("2017-08-01", "ymd")
defaultconf$simulationstartmonth <- defaultconf$currentMonth + months(-1)
# end at well-defined time
defaultconf$simulationendmonth <- parse_date_time('2018-06-01', 'ymd')
# use synthetized 12 and 24 month churns
defaultconf$synthesizelongchurn <- TRUE
# but only synthesize missing entries in churntable
defaultconf$synthesizelongchurnreplaceonly <- TRUE
# use synthetized 3m continuation spectrum, when entries are missing
defaultconf$synthesizecontinuation <- TRUE
# don't experiment with forced 3-12-24
defaultconf$longsubseurcsl <- FALSE
defaultconf$shortsubsusdcsl <- FALSE
# get DB data
dbdata <- getDBData(defaultconf)
# get parms
parms <- getParms(dbdata, defaultconf)
# simulate and enrich
simsubsraw <- simulatesubs(parms, defaultconf)
simsubs <- simsubsenrich(simsubsraw, parms)
numsfull <- getKeyNumbersFull(simsubs, parms)
numsmonthly <- getKeyNumbersMonthly(simsubs, defaultconf, parms)
testvariable <- function(text, expected, found)
{
tol <- 0.001
reldiff <- abs(expected - found)/expected
if (reldiff > tol)
{
print("---------------------------------------")
print(paste("Problem with: ", text, sep = ""))
print(paste("Expected: ", expected, sep = ""))
print(paste("Found: ", found, sep = ""))
print(paste("Relative diff: ", reldiff, sep = ""))
}
}
custsatend <- numsmonthly %>% dplyr::filter(measureMonth == defaultconf$simulationendmonth )  %>% .$numcustomersatend
testvariable("Revenue", 5.380589, mean(numsmonthly$revenue)/1000000)
testvariable("Num new paid customers", 6098, mean(numsmonthly$numnewcustomerspaid))
testvariable("Customers at end", 85471, custsatend)
# print and plot results
plotcustomers(simsubs, defaultconf, parms)
plotchurn(simsubs, defaultconf, parms)
plotarr(simsubs, defaultconf, parms)
plotrevenue(simsubs, defaultconf, parms)
# TODO: this looks strange - why?
#plotrevvsarr(simsubs, parms)
setwd("~/")
setwd("C:/123/subspredictproj")
